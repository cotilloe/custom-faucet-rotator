function generateVisitorsTable(e,t){if(void 0!==e&&void 0!==$(t))return $(t).DataTable({processing:!0,data:e,language:{processing:"Loading..."},order:[[1,"desc"],[2,"desc"],[3,"desc"],[4,"desc"],[5,"desc"],[6,"asc"],[7,"desc"]],columns:[{data:"url",type:"string",render:{_:function(e){var t='<a href="'+e.display+'" title="'+e.original+'">';return t+=e.original+"</a>"},sort:"original"}},{data:"uniqueVisitors",type:"num",render:{_:"display",sort:"original"}},{data:"pageViews",type:"num",render:{_:"display",sort:"original"}},{data:"uniquePageViews",type:"num",render:{_:"display",sort:"original"}},{data:"aveSessionDuration",type:"num",render:{_:"display",sort:"original"}},{data:"aveTimeOnPage",type:"num",render:{_:"display",sort:"original"}},{data:"noOfBounces",type:"num",render:{_:"display",sort:"original"}},{data:"noOfCountries"}],responsive:!0,scrollX:!0,fnStateSave:function(e,t){localStorage.setItem("VisitorsDataTable",JSON.stringify(t))},fnStateLoad:function(e){return JSON.parse(localStorage.getItem("VisitorsDataTable")).iStart=0,e}})}function generateVisitorsLineChart(e,t){var a=getRandomRgb(),r=getRandomRgb();if(void 0!==e&&"error"!==e.status&&void 0!==$(t)[0]){var s=$(t)[0].getContext("2d"),o=[],n=[],i=[];e.forEach(function(e){o.push(new Date(e.date).formatDDMMYYYY()),n.push(parseInt(e.visitors)),i.push(parseInt(e.pageViews))});var l={type:"line",data:{labels:o,datasets:[{label:"Visitors",borderColor:rgbaString(a.r,a.g,a.b),backgroundColor:rgbaString(a.r,a.g,a.b,.5),data:n},{label:"Page views",borderColor:rgbaString(r.r,r.g,r.b),backgroundColor:rgbaString(r.r,r.g,r.b,.5),data:i}]},options:{showScale:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.8,pointDot:!1,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,maintainAspectRatio:!0,responsive:!0,tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){return 0===e.datasetIndex?"Visitors: "+e.yLabel.toString():1===e.datasetIndex?"Page Views: "+e.yLabel.toString():void 0}}},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Number of Visitors / Page Views"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}]}}};return new Chart(s,l)}}function getVisitorsDataAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,quantity:r});return void 0===s?null:$.get(s,function(e){return e.data}).promise()}}function getBrowserStatsAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,maxBrowsers:r});return $.get(s,function(e){return e.data}).promise()}}function generatePieDonutChart(e,t){if(void 0!==e&&void 0!==$(t)){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}var r=a.getContext("2d"),s=[],o=[],n=[];return e.forEach(function(e){o.push(e.browser),n.push(parseInt(e.sessions)),s.push(getRandomHexColor())}),new Chart(r,{type:"doughnut",data:{labels:o,datasets:[{backgroundColor:s,data:n}],options:{segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,responsive:!0,maintainAspectRatio:!0}}})}}function getCountriesAndVisitorsAjax(e,t){var a={status:"error",message:"",code:""};if(null!==e&&null!==t){var r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t});return $.get(r,function(e){return e.data}).promise()}return r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t}),a.message="Both dates cannot be null / empty.",a.code=500,$.get(r,function(){return a}).promise()}function generateGoogleGeoChart(e,t){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}google.charts.load("current",{packages:["geochart"],mapsApiKey:"AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY"});for(var r=0;r<e.length;r++)isNaN(e[r][1])||(e[r][1]=parseInt(e[r][1]));var s,o=e,n=function(){a.innerHTML="";var e=google.visualization.arrayToDataTable(o),t={width:"90%",showLegend:!0,showZoomOut:!0,zoomOutLabel:"Zoom Out"};new google.visualization.GeoChart(a).draw(e,t)};google.charts.setOnLoadCallback(n),jQuery(window).on("resize",function(){clearTimeout(s),s=setTimeout(function(){n()},250)}),jQuery(window).on("reload",function(){clearTimeout(s),s=setTimeout(function(){n()},250)})}$(function(){$.fn.dataTable.ext.errMode="none",$.ajaxSetup({timeout:36e5,cache:!1,crossDomain:!0,xhrFields:{withCredentials:!0},beforeSend:function(e,t){var a=Cookies.get("XSRF-TOKEN");e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("X-XSRF-Token",a)}});var e=currentDate(),t=dateFormatted(alterDate(currentDate().date,-6)),a=500,r=$("#date-from-display"),s=$("#date-to-display");r.text(t.fullDisplay),s.text(e.fullDisplay);var o=$("#from-date");o.val(t.dateFormatted);var n=$("#to-date");n.val(e.dateFormatted),o.prop("placeholder",t),n.prop("placeholder",e),o.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),n.datepicker("option",null,dateFormatted(t).dateFormatted)}}),n.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),o.datepicker("option",null,dateFormatted(t).dateFormatted)}});var i="visitors area chart",l=getVisitorsDataAjax("stats.visits-and-page-views",o.val(),n.val(),a),d=generateProgressBar("#areaChart-progressbar",i);renderVisitorsAreaChart(l,"#areaChart","#areaChart-container","20em",d);var u="visitors datatable",g=getVisitorsDataAjax("stats.top-pages-between-dates",o.val(),n.val(),a),c=generateProgressBar("#visitorsTable-progressbar",u);renderVisitorsDataTable(g,"#visitorsTable",c);var p="visitors geo chart",m=getCountriesAndVisitorsAjax(o.val(),n.val()),v=generateProgressBar("#countriesMap-progressbar",p);renderVisitorsGoogleMap(m,"#regions_div",v,"100%","auto");var b="visitors' browsers chart",f=getBrowserStatsAjax("stats.top-x-browsers",o.val(),n.val(),10),h=generateProgressBar("#pieChart-progressbar",b);renderBrowserStatsPieChart(f,"#pieChart","#pieChart-container","35em",h),$("#stats-form").submit(function(e){e.preventDefault();var t=$("#from-date").val(),l=$("#to-date").val(),d=Number.parseInt(t.substr(0,2)),g=Number.parseInt(t.substr(3,5)),c=Number.parseInt(t.substr(6)),m=Number.parseInt(l.substr(0,2)),v=Number.parseInt(l.substr(3,5)),f=Number.parseInt(l.substr(6)),h=new Date(c,g-1,d),y=new Date(f,v-1,m);void 0!==h&&void 0!==y&&(r.text(dateFormatted(h).fullDisplay),s.text(dateFormatted(y).fullDisplay));var C=getVisitorsDataAjax("stats.visits-and-page-views",t,l,a),S=generateProgressBar("#areaChart-progressbar",i);renderVisitorsAreaChart(C,"#areaChart","#areaChart-container","20em",S,!0);var w=getVisitorsDataAjax("stats.top-pages-between-dates",t,l,a),D=generateProgressBar("#visitorsTable-progressbar",u);renderVisitorsDataTable(w,"table#visitorsTable",D,!0);var x=getCountriesAndVisitorsAjax(o.val(),n.val()),V=generateProgressBar("#countriesMap-progressbar",p);renderVisitorsGoogleMap(x,"#regions_div",V,"100%","auto",!0);var A=getBrowserStatsAjax("stats.top-x-browsers",o.val(),n.val(),10),T=generateProgressBar("#pieChart-progressbar",b);renderBrowserStatsPieChart(A,"#pieChart","#pieChart-container","35em",T,!0)})});